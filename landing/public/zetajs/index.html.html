<!DOCTYPE html>
<html lang="en" style="height:100%">
<head>
  <meta charset="utf-8" />
  <title>ZetaOffice PPT Viewer</title>
  <style>
  /* Ensure the iframe's internal document behaves like a rigid container */
  html, body { 
    margin: 0; 
    padding: 0; 
    width: 100%; 
    height: 100%; 
    overflow: hidden; 
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
  }
  
  /* The canvas must be relative to the flex body, not the absolute window */
  canvas { 
    width: 100% !important; 
    height: 100% !important; 
    display: block;
    outline: none;
    background: #000;
  }

</style>

</head>
<body style="border: none; background: #000;">
<canvas id="qtcanvas" tabindex="0" oncontextmenu="event.preventDefault()" style="background: #000;"></canvas>

<script>
'use strict';
const root = typeof window !== 'undefined' ? window : self;
const canvas = document.getElementById('qtcanvas');

root.Module = {
  canvas,
  uno_scripts: ['/zetajs/zeta.js', '/zetajs/simple.js'],
  locateFile: path => 'https://cdn.zetaoffice.net/zetaoffice_latest/' + path
};

// REPORT DIMENSIONS: Tell the worker exactly how big the container is
const channel = new BroadcastChannel('zeta_channel');

const sendDimensions = () => {
  const width = window.innerWidth;
  const height = window.innerHeight;
  const dpr = window.devicePixelRatio || 1;
  channel.postMessage({ type: 'SET_VIEWER_SIZE', width, height, dpr });
};

channel.onmessage = (e) => {
  if (e.data.type === 'ZETA_READY' || e.data.type === 'REQUEST_CURRENT_SIZE') {
    sendDimensions();
    window.dispatchEvent(new Event('resize'));
  }
};

// Observe resize and report immediately
const ro = new ResizeObserver(() => {
  sendDimensions();
  // Also trigger a standard window resize for the WASM logic
  window.dispatchEvent(new Event('resize'));
});
ro.observe(document.body);

// Relay message logic from before...
window.addEventListener('message', (event) => {
  if (event.data.type === 'LOAD_PPT') {
    channel.postMessage(event.data);
  }
});
</script>

<!-- Load soffice.js after Module is defined -->
<script src="/zetaoffice/soffice.js"></script>

<script>
canvas.addEventListener('wheel', (e) => {
  e.preventDefault();
}, { passive: false });
</script>
</body>
</html>